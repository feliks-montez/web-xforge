<h2>Account details</h2>
<div fxLayout="column" fxLayoutAlign="start start">
  <div fxLayout="row" fxLayout.lt-sm="row wrap" fxLayoutAlign="start stretch" fxLayoutGap="1rem">
    <div class="account-form">
      <form [formGroup]="formGroup">
        <div fxLayout="column" fxLayoutAlign="space-between stretch">
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1rem">
            <div fxFlex>
              <mdc-form-field>
                <mdc-text-field id="name-field" formControlName="name" label="Name"></mdc-text-field>
                <mdc-helper-text>Your name as you would like it to appear on this site</mdc-helper-text>
              </mdc-form-field>
            </div>
            <div>
              <button
                id="name-update-button"
                [disabled]="
                  controlStates.get('name') !== elementState.Dirty && controlStates.get('name') !== elementState.Error
                "
                mdc-button
                outlined
                (click)="updateClicked('name')"
              >
                <mdc-icon
                  id="name-update-done"
                  *ngIf="controlStates.get('name') === elementState.Submitted"
                  class="mdc-button__icon check-icon"
                  >done</mdc-icon
                >
                <mdc-icon
                  id="name-error-icon"
                  *ngIf="controlStates.get('name') === elementState.Error"
                  class="mdc-button__icon error-icon"
                  >error</mdc-icon
                >
                <mdc-icon
                  id="name-button-icon"
                  *ngIf="
                    controlStates.get('name') === elementState.InSync ||
                    controlStates.get('name') === elementState.Dirty
                  "
                  class="mdc-button__icon"
                  >send</mdc-icon
                >
                <mat-spinner
                  id="name-update-spinner"
                  *ngIf="controlStates.get('name') === elementState.Submitting"
                  [diameter]="15"
                  class="mdc-button__icon update-button-spinner"
                  aria-label="Update in progress"
                ></mat-spinner>
                Update
              </button>
            </div>
          </div>

          <div class="last-login-element" fxLayout="row wrap" fxLayoutAlign="start center">
            <div fxFlex class="login-info">
              <span id="last-login">{{ lastLoginMessage }}</span>
            </div>
            <div fxLayoutAlign="end stretch">
              <button id="my-account-change-password-btn" mdc-button outlined [routerLink]="['/change-password']">
                <mdc-icon>edit</mdc-icon>Change password
              </button>
            </div>
          </div>
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1em">
            <div fxFlex>
              <mdc-form-field>
                <mdc-text-field id="email-field" formControlName="email" label="Email"></mdc-text-field>
                <mdc-helper-text *ngIf="!formGroup.get('email').errors" persistent>
                  <span>you@example.com</span>
                </mdc-helper-text>
                <mdc-helper-text *ngIf="formGroup.get('email').errors" validation>
                  <span *ngIf="formGroup.get('email').hasError('required')">
                    You must supply a valid email address.
                  </span>
                  <span *ngIf="formGroup.get('email').hasError('email')">
                    Please enter a valid email address. For example, you@example.com.
                  </span>
                </mdc-helper-text>
              </mdc-form-field>
            </div>
            <div>
              <button
                id="email-update-button"
                [disabled]="
                  controlStates.get('email') !== elementState.Dirty && controlStates.get('email') !== elementState.Error
                "
                mdc-button
                outlined
                (click)="updateClicked('email')"
              >
                <mdc-icon
                  id="email-update-done"
                  *ngIf="controlStates.get('email') === elementState.Submitted"
                  class="mdc-button__icon check-icon"
                  >done</mdc-icon
                >
                <mdc-icon
                  id="email-error-icon"
                  *ngIf="controlStates.get('email') === elementState.Error"
                  class="mdc-button__icon error-icon"
                  >error</mdc-icon
                >
                <mdc-icon
                  id="email-button-icon"
                  *ngIf="
                    controlStates.get('email') === elementState.InSync ||
                    controlStates.get('email') === elementState.Dirty ||
                    controlStates.get('email') === elementState.Invalid
                  "
                  class="mdc-button__icon"
                  >send</mdc-icon
                >
                <mat-spinner
                  id="email-update-spinner"
                  *ngIf="controlStates.get('email') === elementState.Submitting"
                  [diameter]="15"
                  class="mdc-button__icon update-button-spinner"
                  aria-label="Update in progress"
                ></mat-spinner>
                Update
              </button>
            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1rem">
            <div fxFlex>
              <mdc-form-field>
                <mdc-text-field formControlName="mobilePhone" label="Phone"></mdc-text-field>
                <mdc-helper-text persistent>Include country and area codes.</mdc-helper-text>
              </mdc-form-field>
            </div>
            <div>
              <button
                id="mobilePhone-update-button"
                [disabled]="
                  controlStates.get('mobilePhone') !== elementState.Dirty &&
                  controlStates.get('mobilePhone') !== elementState.Error
                "
                mdc-button
                outlined
                (click)="updateClicked('mobilePhone')"
              >
                <mdc-icon
                  id="mobilePhone-update-done"
                  *ngIf="controlStates.get('mobilePhone') === elementState.Submitted"
                  class="mdc-button__icon check-icon"
                  >done</mdc-icon
                >
                <mdc-icon
                  id="mobilePhone-error-icon"
                  *ngIf="controlStates.get('mobilePhone') === elementState.Error"
                  class="mdc-button__icon error-icon"
                  >error</mdc-icon
                >
                <mdc-icon
                  id="mobilePhone-button-icon"
                  *ngIf="
                    controlStates.get('mobilePhone') === elementState.InSync ||
                    controlStates.get('mobilePhone') === elementState.Dirty
                  "
                  class="mdc-button__icon"
                  >send</mdc-icon
                >
                <mat-spinner
                  id="mobilePhone-update-spinner"
                  *ngIf="controlStates.get('mobilePhone') === elementState.Submitting"
                  [diameter]="15"
                  class="mdc-button__icon update-button-spinner"
                  aria-label="Update in progress"
                ></mat-spinner>
                Update
              </button>
            </div>
          </div>
          <!-- TODO SF-178: This control can be restored (and converted to MDC) when SMS notification is implemented.
        <div fxLayout="column">
          <div>Receive messages via</div>
          <div>
            <mat-button-toggle-group formControlName="contactMethod" (click)="update('contactMethod')">
              <mat-button-toggle value="email" [disabled]="!!contactMethodToggleDisabled.get('email')"
                ><i class="material-icons">email</i> Email</mat-button-toggle
              >
              <mat-button-toggle value="sms" [disabled]="!!contactMethodToggleDisabled.get('sms')"
                ><i class="material-icons">textsms</i> SMS</mat-button-toggle
              >
              <mat-button-toggle value="emailSms" [disabled]="!!contactMethodToggleDisabled.get('emailSms')"
                ><i class="material-icons">email</i><i class="material-icons">textsms</i> Both</mat-button-toggle
              >
            </mat-button-toggle-group>
            <mat-spinner
              id="contactMethod-update-spinner"
              *ngIf="controlStates.get('contactMethod') === elementState.Submitting"
              [diameter]="15"
              class="contactMethod-spinner"
              aria-label="Update in progress"
            ></mat-spinner>
            <i
              id="contactMethod-update-done"
              *ngIf="controlStates.get('contactMethod') === elementState.Submitted"
              class="material-icons check-icon"
              >done</i
            >
            <i
              id="contactMethod-error-icon"
              *ngIf="controlStates.get('contactMethod') === elementState.Error"
              class="material-icons error-icon"
              >error</i
            >
          </div>
        </div>
-->
          <div fxLayout="row" fxLayoutAlign="start center">
            <div fxFlex>
              <mdc-form-field>
                <mdc-text-field type="date" label="Birthdate" formControlName="birthday" (change)="update('birthday')">
                  <mdc-icon mdcTextFieldIcon trailing>event</mdc-icon>
                </mdc-text-field>
                <mdc-helper-text persistent><span>MM-DD-YYYY</span></mdc-helper-text>
              </mdc-form-field>
            </div>
            <div>
              <mat-spinner
                id="birthday-update-spinner"
                *ngIf="controlStates.get('birthday') === elementState.Submitting"
                [diameter]="15"
                class="birthday-spinner"
                aria-label="Update in progress"
              ></mat-spinner>
              <mdc-icon
                id="birthday-update-done"
                *ngIf="controlStates.get('birthday') === elementState.Submitted"
                class="check-icon"
                >done</mdc-icon
              >
              <mdc-icon id="birthday-error-icon" *ngIf="controlStates.get('birthday') === elementState.Error"
                >error</mdc-icon
              >
            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="start center" class="gender-input">
            <mdc-form-field fluid>
              <mdc-select
                id="gender-select"
                formControlName="gender"
                placeholder="Gender"
                (valueChange)="update('gender', $event.value)"
              >
                <mdc-menu>
                  <mdc-list>
                    <mdc-list-item value="female">Female</mdc-list-item>
                    <mdc-list-item value="male">Male</mdc-list-item>
                  </mdc-list>
                </mdc-menu>
              </mdc-select>
            </mdc-form-field>
            <mat-spinner
              id="gender-update-spinner"
              *ngIf="controlStates.get('gender') === elementState.Submitting"
              [diameter]="15"
              class="gender-spinner"
              aria-label="Update in progress"
            ></mat-spinner>
            <mdc-icon
              id="gender-update-done"
              *ngIf="controlStates.get('gender') === elementState.Submitted"
              class="check-icon"
              >done</mdc-icon
            >
            <mdc-icon
              id="gender-error-icon"
              *ngIf="controlStates.get('gender') === elementState.Error"
              class="material-icons error-icon"
              >error</mdc-icon
            >
          </div>
          <div
            *ngIf="isLinkedToParatext"
            fxLayout="row"
            fxLayoutAlign="space-between center"
            fxLayoutGap="1rem"
            id="paratext-link"
            class="linked-paratext"
          >
            <div>Linked to Paratext account</div>
            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="0.5rem">
              <label id="paratext-link-label">
                <strong>{{ paratextUsername }}</strong>
              </label>
              <button mdc-button id="unlink-paratext-button" class="unlink-button" (click)="deleteParatextLink()">
                <mdc-icon>clear</mdc-icon> <span fxHide.lt-md>Remove link</span>
              </button>
            </div>
          </div>
          <div *ngIf="!isLinkedToParatext" id="paratext-link" class="linked-paratext">
            <button mdc-button outlined id="connect-paratext-button" (click)="logInWithParatext()">
              <mdc-icon>link</mdc-icon> Connect to Paratext
            </button>
          </div>
          <!--Add this back in once login with Google (SF-77) is finished
      <div
        *ngIf="isLinkedToGoogle"
        fxLayout="row"
        fxLayoutAlign="space-between center"
        fxLayoutGap="1rem"
        id="google-link"
        class="linked-google"
      >
        <div>Linked to Google account</div>
        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="0.5rem">
          <label
            ><strong>{{ googleUsername }}</strong></label
          >
          <button mdc-button outlined id="unlink-google-button class="unlink-button" (click)="deleteGoogleLink()">
            <mdc-icon>clear</mdc-icon> <span fxHide.lt-md>Remove link</span>
          </button>
        </div>
      </div>
      <div *ngIf="!isLinkedToGoogle" id="google-link" class="linked-google">
        <button mdc-button outlined><mdc-icon>link</mdc-icon> Connect to Google</button>
      </div>
      -->
        </div>
      </form>
    </div>
    <div fxLayout="column">
      <div *ngIf="showAvatar"><app-avatar [user]="userFromDatabase" size="192" [round]="false"></app-avatar></div>
      <button mdc-button ngfSelect [(file)]="pictureFile" (fileChange)="uploadPicture()" accept="image/*">
        Upload picture
      </button>
    </div>
  </div>

  <div fxLayout="column" fxLayoutAlign="space-between stretch" id="delete-account" class="delete-account">
    <h2>Delete account</h2>
    <mdc-card>
      <h2>Delete my account ({{ userName }})</h2>
      <div>
        <p>Once you delete your account, there is no going back. Please be certain.</p>
        <p><strong>You will lose access to your projects.</strong></p>
      </div>
      <mdc-card-actions fxLayout="row" fxLayoutAlign="end stretch">
        <button mdc-button unelevated (click)="openDeleteAccountDialog()" id="delete-account-button">
          Delete my account
        </button>
      </mdc-card-actions>
    </mdc-card>
  </div>
</div>
